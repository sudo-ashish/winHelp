<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    WindowStyle="None"
    AllowsTransparency="True"
    ResizeMode="CanResizeWithGrip"
    Width="920" Height="640"
    MinWidth="700" MinHeight="480"
    WindowStartupLocation="CenterScreen"
    Background="Transparent">

    <Window.Resources>

        <!-- ── Header button base style ─────────────────────────── -->
        <Style x:Key="HeaderButtonStyle" TargetType="Button">
            <Setter Property="Background"       Value="Transparent"/>
            <Setter Property="BorderThickness"  Value="0"/>
            <Setter Property="Foreground"       Value="{DynamicResource TextPrimary}"/>
            <Setter Property="Width"            Value="34"/>
            <Setter Property="Height"           Value="32"/>
            <Setter Property="FontSize"         Value="14"/>
            <Setter Property="Cursor"           Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="6,0">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background"
                                        Value="{DynamicResource ButtonHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background"
                                        Value="{DynamicResource ButtonPressed}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ── Close button (red hover) ────────────────────────── -->
        <Style x:Key="CloseButtonStyle" TargetType="Button"
               BasedOn="{StaticResource HeaderButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="6,0">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#C42B1C"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#A01010"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ── Toggle button (theme switcher) ───────────────────── -->
        <Style x:Key="ToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background"       Value="Transparent"/>
            <Setter Property="BorderThickness"  Value="0"/>
            <Setter Property="Foreground"       Value="{DynamicResource TextPrimary}"/>
            <Setter Property="Width"            Value="34"/>
            <Setter Property="Height"           Value="32"/>
            <Setter Property="FontSize"         Value="14"/>
            <Setter Property="Cursor"           Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="6,0">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background"
                                        Value="{DynamicResource ButtonHover}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="bd" Property="Background"
                                        Value="{DynamicResource ButtonPressed}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ── TabItem style ────────────────────────────────────── -->
        <Style x:Key="WinHelpTabItemStyle" TargetType="TabItem">
            <Setter Property="Background"   Value="{DynamicResource TabItemBackground}"/>
            <Setter Property="Foreground"   Value="{DynamicResource TabItemForeground}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding"      Value="16,8"/>
            <Setter Property="FontSize"     Value="13"/>
            <Setter Property="Cursor"       Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="tabBd"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0,0,0,2"
                                BorderBrush="Transparent"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter ContentSource="Header"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="tabBd" Property="Background"
                                        Value="{DynamicResource TabItemSelected}"/>
                                <Setter TargetName="tabBd" Property="BorderBrush"
                                        Value="{DynamicResource AccentColor}"/>
                                <Setter Property="Foreground"
                                        Value="{DynamicResource TabItemSelectedFg}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="tabBd" Property="Background"
                                        Value="{DynamicResource ButtonHover}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <!-- ── Outer container ──────────────────────────────────────── -->
    <Border Background="{DynamicResource WindowBackground}"
            BorderBrush="{DynamicResource BorderColor}"
            BorderThickness="1"
            CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="42"/>   <!-- 0: Header -->
                <RowDefinition Height="40"/>   <!-- 1: Tab strip -->
                <RowDefinition Height="*"/>    <!-- 2: Content -->
                <RowDefinition Height="24"/>   <!-- 3: Status bar -->
            </Grid.RowDefinitions>

            <!-- ──── ROW 0: Header bar ──────────────────────────── -->
            <Border Grid.Row="0"
                    x:Name="HeaderBar"
                    Background="{DynamicResource HeaderBackground}"
                    CornerRadius="8,8,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>  <!-- icon + title -->
                        <ColumnDefinition Width="*"/>     <!-- drag area -->
                        <ColumnDefinition Width="Auto"/>  <!-- controls -->
                    </Grid.ColumnDefinitions>

                    <!-- App icon + title -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="12,0,0,0">
                        <Ellipse Width="12" Height="12"
                                 Fill="{DynamicResource AccentColor}"
                                 Margin="0,0,8,0"/>
                        <TextBlock x:Name="TitleText"
                                   Text="winHelp"
                                   Foreground="{DynamicResource TextPrimary}"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Spacer (drag target) -->
                    <Rectangle Grid.Column="1" Fill="Transparent"/>

                    <!-- Window controls -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,6,0">
                        <ToggleButton x:Name="ThemeToggle"
                                      Content="☀"
                                      Style="{StaticResource ToggleButtonStyle}"
                                      ToolTip="Toggle Light/Dark Theme"/>
                        <Button x:Name="ReloadBtn"
                                Content="↻"
                                Style="{StaticResource HeaderButtonStyle}"
                                ToolTip="Reload winHelp"
                                Margin="2,0"/>
                        <Button x:Name="CloseBtn"
                                Content="✕"
                                Style="{StaticResource CloseButtonStyle}"
                                ToolTip="Close"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ──── ROW 1: Tab strip ────────────────────────────── -->
            <Border Grid.Row="1"
                    Background="{DynamicResource TabBackground}"
                    BorderBrush="{DynamicResource BorderColor}"
                    BorderThickness="0,0,0,1">
                <TabControl x:Name="MainTabControl"
                            Background="Transparent"
                            BorderThickness="0"
                            TabStripPlacement="Top"
                            ItemContainerStyle="{StaticResource WinHelpTabItemStyle}">
                    <!-- Tabs injected programmatically by TabManager.ps1 -->
                </TabControl>
            </Border>

            <!-- ──── ROW 2: Content area ─────────────────────────── -->
            <Border Grid.Row="2"
                    Background="{DynamicResource ContentBackground}">
                <Grid x:Name="TabContentArea"
                      Margin="16"/>
            </Border>

            <!-- ──── ROW 3: Status bar ───────────────────────────── -->
            <Border Grid.Row="3"
                    Background="{DynamicResource StatusBackground}"
                    CornerRadius="0,0,8,8">
                <TextBlock x:Name="StatusText"
                           Text="Ready"
                           Foreground="{DynamicResource TextMuted}"
                           FontSize="11"
                           VerticalAlignment="Center"
                           Margin="12,0"/>
            </Border>

        </Grid>
    </Border>
</Window>
